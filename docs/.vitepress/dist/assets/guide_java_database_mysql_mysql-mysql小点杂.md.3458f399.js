import{_ as o,C as e,o as t,c,H as l,w as n,Q as s,a as p}from"./chunks/framework.dd5a1521.js";const m=JSON.parse('{"title":"mysql小点杂","description":"","frontmatter":{"title":"mysql小点杂","date":"2021-09-30T09:34:36.000Z"},"headers":[],"relativePath":"guide/java/database/mysql/mysql-mysql小点杂.md","filePath":"guide/java/database/mysql/mysql-mysql小点杂.md"}'),r={name:"guide/java/database/mysql/mysql-mysql小点杂.md"},E=s(`<h4 id="时间差" tabindex="-1">时间差 <a class="header-anchor" href="#时间差" aria-label="Permalink to &quot;时间差&quot;">​</a></h4><ul><li>类型</li></ul><table><thead><tr><th>秒数</th><th>分钟数</th><th>小时数</th><th>天数</th><th>周数</th><th>季度数</th><th>月数</th><th>年数</th></tr></thead><tbody><tr><td>SECOND</td><td>MINUTE</td><td>HOUR</td><td>DAY</td><td>WEEK</td><td>QUARTER</td><td>MONTH</td><td>YEAR</td></tr></tbody></table><ul><li>举例</li></ul><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">SELECT</span><span style="color:#E1E4E8;"> TIMESTAMPDIFF(</span><span style="color:#F97583;">SECOND</span><span style="color:#E1E4E8;">,‘</span><span style="color:#79B8FF;">1993</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">03</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">00</span><span style="color:#E1E4E8;">:</span><span style="color:#79B8FF;">00</span><span style="color:#E1E4E8;">:</span><span style="color:#79B8FF;">00</span><span style="color:#E1E4E8;">’,</span><span style="color:#F97583;">DATE_FORMAT</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">NOW</span><span style="color:#E1E4E8;">(), </span><span style="color:#9ECBFF;">&#39;%Y-%m-%d %H:%i:%S&#39;</span><span style="color:#E1E4E8;">))</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">SELECT</span><span style="color:#24292E;"> TIMESTAMPDIFF(</span><span style="color:#D73A49;">SECOND</span><span style="color:#24292E;">,‘</span><span style="color:#005CC5;">1993</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">03</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">00</span><span style="color:#24292E;">:</span><span style="color:#005CC5;">00</span><span style="color:#24292E;">:</span><span style="color:#005CC5;">00</span><span style="color:#24292E;">’,</span><span style="color:#D73A49;">DATE_FORMAT</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">NOW</span><span style="color:#24292E;">(), </span><span style="color:#032F62;">&#39;%Y-%m-%d %H:%i:%S&#39;</span><span style="color:#24292E;">))</span></span></code></pre></div><h4 id="补位" tabindex="-1">补位 <a class="header-anchor" href="#补位" aria-label="Permalink to &quot;补位&quot;">​</a></h4><ul><li>前后补字符</li></ul><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">select</span><span style="color:#E1E4E8;"> RPAD(</span><span style="color:#9ECBFF;">&#39;1&#39;</span><span style="color:#E1E4E8;">,</span><span style="color:#79B8FF;">8</span><span style="color:#E1E4E8;">,</span><span style="color:#9ECBFF;">&#39;0&#39;</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> num</span></span>
<span class="line"><span style="color:#F97583;">select</span><span style="color:#E1E4E8;"> LPAD(</span><span style="color:#9ECBFF;">&#39;1&#39;</span><span style="color:#E1E4E8;">,</span><span style="color:#79B8FF;">8</span><span style="color:#E1E4E8;">,</span><span style="color:#9ECBFF;">&#39;0&#39;</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> num</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">select</span><span style="color:#24292E;"> RPAD(</span><span style="color:#032F62;">&#39;1&#39;</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">8</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&#39;0&#39;</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> num</span></span>
<span class="line"><span style="color:#D73A49;">select</span><span style="color:#24292E;"> LPAD(</span><span style="color:#032F62;">&#39;1&#39;</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">8</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&#39;0&#39;</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> num</span></span></code></pre></div><h4 id="varchar转decimal" tabindex="-1">varchar转decimal <a class="header-anchor" href="#varchar转decimal" aria-label="Permalink to &quot;varchar转decimal&quot;">​</a></h4><ul><li>常用于varchar存小数，要算最小值和最大值时的转换</li></ul><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">select</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">CAST</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;21.00000&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">AS</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">DECIMAL</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">10</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">3</span><span style="color:#E1E4E8;">))</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">select</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">CAST</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;21.00000&#39;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">AS</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">DECIMAL</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">10</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">3</span><span style="color:#24292E;">))</span></span></code></pre></div><h4 id="行拆分" tabindex="-1">行拆分 <a class="header-anchor" href="#行拆分" aria-label="Permalink to &quot;行拆分&quot;">​</a></h4><ul><li>对于逗号隔开的数据拆分成行</li></ul><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">SELECT</span></span>
<span class="line"><span style="color:#E1E4E8;">    substring_index(substring_index( </span><span style="color:#79B8FF;">a</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">note</span><span style="color:#E1E4E8;">,</span><span style="color:#9ECBFF;">&#39;,&#39;</span><span style="color:#E1E4E8;">,</span><span style="color:#79B8FF;">b</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">help_topic_id</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">),</span><span style="color:#9ECBFF;">&#39;,&#39;</span><span style="color:#E1E4E8;"> ,</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#F97583;">FROM</span></span>
<span class="line"><span style="color:#E1E4E8;">    (</span><span style="color:#F97583;">select</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;1,2,3,4&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> note) a  </span></span>
<span class="line"><span style="color:#F97583;">JOIN</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">mysql</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">help_topic</span><span style="color:#E1E4E8;"> b </span><span style="color:#F97583;">ON</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">b</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">help_topic_id</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;</span></span>
<span class="line"><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">length</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">a</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">note</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">length</span><span style="color:#E1E4E8;">( </span><span style="color:#79B8FF;">replace</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">a</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">note</span><span style="color:#E1E4E8;">,</span><span style="color:#9ECBFF;">&#39;,&#39;</span><span style="color:#E1E4E8;">,</span><span style="color:#9ECBFF;">&#39;&#39;</span><span style="color:#E1E4E8;">)) </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">SELECT</span></span>
<span class="line"><span style="color:#24292E;">    substring_index(substring_index( </span><span style="color:#005CC5;">a</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">note</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&#39;,&#39;</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">b</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">help_topic_id</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">),</span><span style="color:#032F62;">&#39;,&#39;</span><span style="color:#24292E;"> ,</span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#D73A49;">FROM</span></span>
<span class="line"><span style="color:#24292E;">    (</span><span style="color:#D73A49;">select</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;1,2,3,4&#39;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> note) a  </span></span>
<span class="line"><span style="color:#D73A49;">JOIN</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">mysql</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">help_topic</span><span style="color:#24292E;"> b </span><span style="color:#D73A49;">ON</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">b</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">help_topic_id</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span></span>
<span class="line"><span style="color:#24292E;">(</span><span style="color:#D73A49;">length</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">a</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">note</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">length</span><span style="color:#24292E;">( </span><span style="color:#005CC5;">replace</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">a</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">note</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&#39;,&#39;</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&#39;&#39;</span><span style="color:#24292E;">)) </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">)</span></span></code></pre></div><ul><li>变形，补行</li></ul><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">SELECT</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">a</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">startNum</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">b</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">help_topic_id</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">AS</span><span style="color:#E1E4E8;"> rn</span></span>
<span class="line"><span style="color:#F97583;">FROM</span></span>
<span class="line"><span style="color:#E1E4E8;">    (</span><span style="color:#F97583;">select</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;001&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">AS</span><span style="color:#E1E4E8;"> startNum,</span><span style="color:#9ECBFF;">&#39;200&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> endNumber) a  </span></span>
<span class="line"><span style="color:#F97583;">JOIN</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">mysql</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">help_topic</span><span style="color:#E1E4E8;"> b </span><span style="color:#F97583;">ON</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">b</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">help_topic_id</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;</span></span>
<span class="line"><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">a</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">endNumber</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">a</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">startNum</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">SELECT</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">a</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">startNum</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">b</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">help_topic_id</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">AS</span><span style="color:#24292E;"> rn</span></span>
<span class="line"><span style="color:#D73A49;">FROM</span></span>
<span class="line"><span style="color:#24292E;">    (</span><span style="color:#D73A49;">select</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;001&#39;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">AS</span><span style="color:#24292E;"> startNum,</span><span style="color:#032F62;">&#39;200&#39;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> endNumber) a  </span></span>
<span class="line"><span style="color:#D73A49;">JOIN</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">mysql</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">help_topic</span><span style="color:#24292E;"> b </span><span style="color:#D73A49;">ON</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">b</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">help_topic_id</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span></span>
<span class="line"><span style="color:#24292E;">(</span><span style="color:#005CC5;">a</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">endNumber</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">a</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">startNum</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">)</span></span></code></pre></div><ul><li>结合上面的行拆分</li></ul><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">SELECT</span></span>
<span class="line"><span style="color:#E1E4E8;">    LPAD(</span><span style="color:#79B8FF;">a</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">startNum</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">b</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">help_topic_id</span><span style="color:#E1E4E8;">,</span><span style="color:#79B8FF;">3</span><span style="color:#E1E4E8;">,</span><span style="color:#9ECBFF;">&#39;0&#39;</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">AS</span><span style="color:#E1E4E8;"> rn</span></span>
<span class="line"><span style="color:#F97583;">FROM</span></span>
<span class="line"><span style="color:#E1E4E8;">    (</span><span style="color:#F97583;">select</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;001&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">AS</span><span style="color:#E1E4E8;"> startNum,</span><span style="color:#9ECBFF;">&#39;200&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> endNumber) a  </span></span>
<span class="line"><span style="color:#F97583;">JOIN</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">mysql</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">help_topic</span><span style="color:#E1E4E8;"> b </span><span style="color:#F97583;">ON</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">b</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">help_topic_id</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;</span></span>
<span class="line"><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">a</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">endNumber</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">a</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">startNum</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">SELECT</span></span>
<span class="line"><span style="color:#24292E;">    LPAD(</span><span style="color:#005CC5;">a</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">startNum</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">b</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">help_topic_id</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">3</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&#39;0&#39;</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">AS</span><span style="color:#24292E;"> rn</span></span>
<span class="line"><span style="color:#D73A49;">FROM</span></span>
<span class="line"><span style="color:#24292E;">    (</span><span style="color:#D73A49;">select</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;001&#39;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">AS</span><span style="color:#24292E;"> startNum,</span><span style="color:#032F62;">&#39;200&#39;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> endNumber) a  </span></span>
<span class="line"><span style="color:#D73A49;">JOIN</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">mysql</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">help_topic</span><span style="color:#24292E;"> b </span><span style="color:#D73A49;">ON</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">b</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">help_topic_id</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span></span>
<span class="line"><span style="color:#24292E;">(</span><span style="color:#005CC5;">a</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">endNumber</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">a</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">startNum</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">)</span></span></code></pre></div><h4 id="逗号隔开的数据关联查询" tabindex="-1">逗号隔开的数据关联查询 <a class="header-anchor" href="#逗号隔开的数据关联查询" aria-label="Permalink to &quot;逗号隔开的数据关联查询&quot;">​</a></h4><p>table2的PARAM_ID是逗号隔开的，要查询显示逗号隔开的table2.PARAM_NAME</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">SELECT</span></span>
<span class="line"><span style="color:#E1E4E8;">	GROUP_CONCAT( </span><span style="color:#79B8FF;">table2</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">PARAM_NAME</span><span style="color:#E1E4E8;"> ) </span></span>
<span class="line"><span style="color:#F97583;">FROM</span></span>
<span class="line"><span style="color:#E1E4E8;">	table2 </span></span>
<span class="line"><span style="color:#F97583;">WHERE</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#79B8FF;">table2</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">PARAM_ID</span><span style="color:#E1E4E8;"> REGEXP ( </span><span style="color:#F97583;">SELECT</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">REPLACE</span><span style="color:#E1E4E8;"> ( ( </span><span style="color:#F97583;">SELECT</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">table1</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">PARAM_ID</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">FROM</span><span style="color:#E1E4E8;"> table1 </span><span style="color:#F97583;">WHERE</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">table1</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">id</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;1&#39;</span><span style="color:#E1E4E8;"> ), </span><span style="color:#9ECBFF;">&#39;,&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&#39;|&#39;</span><span style="color:#E1E4E8;"> ) )</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">SELECT</span></span>
<span class="line"><span style="color:#24292E;">	GROUP_CONCAT( </span><span style="color:#005CC5;">table2</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">PARAM_NAME</span><span style="color:#24292E;"> ) </span></span>
<span class="line"><span style="color:#D73A49;">FROM</span></span>
<span class="line"><span style="color:#24292E;">	table2 </span></span>
<span class="line"><span style="color:#D73A49;">WHERE</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#005CC5;">table2</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">PARAM_ID</span><span style="color:#24292E;"> REGEXP ( </span><span style="color:#D73A49;">SELECT</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">REPLACE</span><span style="color:#24292E;"> ( ( </span><span style="color:#D73A49;">SELECT</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">table1</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">PARAM_ID</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">FROM</span><span style="color:#24292E;"> table1 </span><span style="color:#D73A49;">WHERE</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">table1</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">id</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;1&#39;</span><span style="color:#24292E;"> ), </span><span style="color:#032F62;">&#39;,&#39;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&#39;|&#39;</span><span style="color:#24292E;"> ) )</span></span></code></pre></div><h4 id="行转列" tabindex="-1">行转列 <a class="header-anchor" href="#行转列" aria-label="Permalink to &quot;行转列&quot;">​</a></h4><ul><li>逗号隔开的数据</li></ul><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">SELECT</span></span>
<span class="line"><span style="color:#E1E4E8;">	SUBSTRING_INDEX( SUBSTRING_INDEX( </span><span style="color:#9ECBFF;">&#39;1,2,3,4&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&#39;,&#39;</span><span style="color:#E1E4E8;">, help_topic_id </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> ), </span><span style="color:#9ECBFF;">&#39;,&#39;</span><span style="color:#E1E4E8;">,</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> ) </span><span style="color:#F97583;">AS</span><span style="color:#E1E4E8;"> num </span></span>
<span class="line"><span style="color:#F97583;">FROM</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#79B8FF;">mysql</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">help_topic</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#F97583;">WHERE</span></span>
<span class="line"><span style="color:#E1E4E8;">	help_topic_id </span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">LENGTH</span><span style="color:#E1E4E8;">( </span><span style="color:#9ECBFF;">&#39;1,2,3,4&#39;</span><span style="color:#E1E4E8;"> ) </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">LENGTH</span><span style="color:#E1E4E8;">( </span><span style="color:#79B8FF;">REPLACE</span><span style="color:#E1E4E8;"> ( </span><span style="color:#9ECBFF;">&#39;1,2,3,4&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&#39;,&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&#39;&#39;</span><span style="color:#E1E4E8;"> ) ) </span><span style="color:#F97583;">+</span><span style="color:#79B8FF;">1</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">SELECT</span></span>
<span class="line"><span style="color:#24292E;">	SUBSTRING_INDEX( SUBSTRING_INDEX( </span><span style="color:#032F62;">&#39;1,2,3,4&#39;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&#39;,&#39;</span><span style="color:#24292E;">, help_topic_id </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> ), </span><span style="color:#032F62;">&#39;,&#39;</span><span style="color:#24292E;">,</span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> ) </span><span style="color:#D73A49;">AS</span><span style="color:#24292E;"> num </span></span>
<span class="line"><span style="color:#D73A49;">FROM</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#005CC5;">mysql</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">help_topic</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#D73A49;">WHERE</span></span>
<span class="line"><span style="color:#24292E;">	help_topic_id </span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">LENGTH</span><span style="color:#24292E;">( </span><span style="color:#032F62;">&#39;1,2,3,4&#39;</span><span style="color:#24292E;"> ) </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">LENGTH</span><span style="color:#24292E;">( </span><span style="color:#005CC5;">REPLACE</span><span style="color:#24292E;"> ( </span><span style="color:#032F62;">&#39;1,2,3,4&#39;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&#39;,&#39;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&#39;&#39;</span><span style="color:#24292E;"> ) ) </span><span style="color:#D73A49;">+</span><span style="color:#005CC5;">1</span></span></code></pre></div><ul><li>非逗号隔开的数据</li></ul><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">SELECT</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">LEFT</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">SUBSTRING</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;QWER&#39;</span><span style="color:#E1E4E8;">,help_topic_id</span><span style="color:#F97583;">+</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">),</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">AS</span><span style="color:#E1E4E8;"> num </span><span style="color:#F97583;">FROM</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">mysql</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">help_topic</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">WHERE</span><span style="color:#E1E4E8;"> help_topic_id </span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">LENGTH</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;QWER&#39;</span><span style="color:#E1E4E8;">);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">SELECT</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">LEFT</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">SUBSTRING</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;QWER&#39;</span><span style="color:#24292E;">,help_topic_id</span><span style="color:#D73A49;">+</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">),</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">AS</span><span style="color:#24292E;"> num </span><span style="color:#D73A49;">FROM</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">mysql</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">help_topic</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">WHERE</span><span style="color:#24292E;"> help_topic_id </span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">LENGTH</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;QWER&#39;</span><span style="color:#24292E;">);</span></span></code></pre></div><h4 id="常用语法" tabindex="-1">常用语法 <a class="header-anchor" href="#常用语法" aria-label="Permalink to &quot;常用语法&quot;">​</a></h4>`,27),y=s('<div class="language-SQL vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">SQL</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">SELECT</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">FROM</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">INFORMATION_SCHEMA</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">COLUMNS</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">where</span><span style="color:#E1E4E8;"> TABLE_NAME</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&#39;表名&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">and</span><span style="color:#E1E4E8;"> COLUMN_NAME</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&#39;列名&#39;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">SELECT</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">FROM</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">INFORMATION_SCHEMA</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">COLUMNS</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">where</span><span style="color:#24292E;"> TABLE_NAME</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&#39;表名&#39;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">and</span><span style="color:#24292E;"> COLUMN_NAME</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&#39;列名&#39;</span></span></code></pre></div>',1),i=s(`<div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">select</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">CONCAT</span><span style="color:#E1E4E8;">(A, B, C) </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">table</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">select</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">CONCAT</span><span style="color:#24292E;">(A, B, C) </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">table</span></span></code></pre></div><p>参数连接用concat函数</p><p>注：存在复杂字符串连接，若其中某个字段查询为null，则整个字符串为null(解决办法为通过IFNULL函数判断，IFNULL(AAA,&#39;&#39;))</p><h4 id="查看执行计划" tabindex="-1">查看执行计划 <a class="header-anchor" href="#查看执行计划" aria-label="Permalink to &quot;查看执行计划&quot;">​</a></h4><p>explain 字段</p><ul><li>查看mysql的耗cpu</li></ul><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">select</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">performance_schema</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">threads</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">where</span><span style="color:#E1E4E8;"> PROCESSLIST_COMMAND </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;Query&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">order by</span><span style="color:#E1E4E8;"> THREAD_OS_ID </span><span style="color:#F97583;">DESC</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">select</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">performance_schema</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">threads</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">where</span><span style="color:#24292E;"> PROCESSLIST_COMMAND </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;Query&#39;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">order by</span><span style="color:#24292E;"> THREAD_OS_ID </span><span style="color:#D73A49;">DESC</span></span></code></pre></div><p>注：THREAD_OS_ID越高用的线程数越高</p><ul><li>查看目前正在查询的耗时时间长的SQL</li></ul><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">select</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> information_schema.</span><span style="color:#9ECBFF;">\`PROCESSLIST\`</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">where</span><span style="color:#E1E4E8;"> Command </span><span style="color:#F97583;">!=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;Sleep&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">order by</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">\`time\`</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">DESC</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">select</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> information_schema.</span><span style="color:#032F62;">\`PROCESSLIST\`</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">where</span><span style="color:#24292E;"> Command </span><span style="color:#D73A49;">!=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;Sleep&#39;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">order by</span><span style="color:#24292E;"> </span><span style="color:#032F62;">\`time\`</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">DESC</span></span></code></pre></div><ul><li>查看当前ip的执行记录</li></ul><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">select</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> information_schema.</span><span style="color:#9ECBFF;">\`PROCESSLIST\`</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">where</span><span style="color:#E1E4E8;"> HOST </span><span style="color:#F97583;">LIKE</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;10.245.228.89%&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">order by</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">\`time\`</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">DESC</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">select</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">*</span><span style="color:#24292E;">  </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> information_schema.</span><span style="color:#032F62;">\`PROCESSLIST\`</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">where</span><span style="color:#24292E;"> HOST </span><span style="color:#D73A49;">LIKE</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;10.245.228.89%&#39;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">order by</span><span style="color:#24292E;"> </span><span style="color:#032F62;">\`time\`</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">DESC</span></span></code></pre></div><ul><li>查看全表扫描的</li></ul><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">select</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> statements_with_full_table_scans;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">select</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> statements_with_full_table_scans;</span></span></code></pre></div><p>各个参数代表以下含义：</p><ol><li><p><code>query</code>：执行全表扫描的查询语句。</p></li><li><p><code>db</code>：查询所属的数据库名称。</p></li><li><p><code>exec_count</code>：查询的执行次数。</p></li><li><p><code>total_latency</code>：查询的总延迟时间。</p></li><li><p><code>rows_sent</code>：查询返回的行数。</p></li><li><p><code>rows_examined</code>：查询扫描的行数，包括通过全表扫描访问的行数。</p></li><li><p><code>rows_affected</code>：查询影响的行数。</p></li><li><p><code>full_scan</code>：指示是否进行了全表扫描，通常是一个布尔值或标志。</p></li></ol><p>注：<code>query</code>查询的语句不是完整的，所以也只能通过其它方式查看全表扫描的表</p><ul><li>查看锁表</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">select * from innodb_lock_waits;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">select * from innodb_lock_waits;</span></span></code></pre></div><p>表中的一些常见字段的含义：</p><p>1.<code>requesting_trx_id</code>：正在请求锁定的事务ID。</p><p>2.<code>requested_lock_id</code>：正在请求的锁定ID。</p><p>3.<code>blocking_trx_id</code>：正在阻塞当前请求的事务ID。</p><p>4.<code>blocking_lock_id</code>：导致阻塞的锁定ID。</p><p>5.<code>requested_lock_mode</code>：正在请求的锁定模式，例如共享锁（S）或排他锁（X）。</p><p>6.<code>blocking_lock_mode</code>：导致阻塞的锁定模式。</p><p>7.<code>waiting_query</code>：正在等待锁定的查询语句。</p><p>8.<code>blocking_query</code>：导致阻塞的查询语句。</p><p>9.<code>wait_started</code>：等待开始的时间戳。</p><p>10.<code>wait_age</code>：等待持续的时间。</p><ul><li>查询缓存</li></ul><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">#quert_cache_type </span><span style="color:#79B8FF;">0</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">关闭 </span><span style="color:#79B8FF;">1</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">开启 </span><span style="color:#79B8FF;">2</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">查询使用SQL_CACHE的才缓存 </span></span>
<span class="line"><span style="color:#E1E4E8;">#linux </span><span style="color:#79B8FF;">my</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">cnf文件</span></span>
<span class="line"><span style="color:#E1E4E8;">query_cache_type</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#E1E4E8;">#使用方法(一般对于静态表才使用缓存)</span></span>
<span class="line"><span style="color:#F97583;">SELECT</span><span style="color:#E1E4E8;"> SQL_CACHE </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">FROM</span><span style="color:#E1E4E8;"> test </span><span style="color:#F97583;">where</span><span style="color:#E1E4E8;"> id </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">#quert_cache_type </span><span style="color:#005CC5;">0</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">关闭 </span><span style="color:#005CC5;">1</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">开启 </span><span style="color:#005CC5;">2</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">查询使用SQL_CACHE的才缓存 </span></span>
<span class="line"><span style="color:#24292E;">#linux </span><span style="color:#005CC5;">my</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">cnf文件</span></span>
<span class="line"><span style="color:#24292E;">query_cache_type</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#24292E;">#使用方法(一般对于静态表才使用缓存)</span></span>
<span class="line"><span style="color:#D73A49;">SELECT</span><span style="color:#24292E;"> SQL_CACHE </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">FROM</span><span style="color:#24292E;"> test </span><span style="color:#D73A49;">where</span><span style="color:#24292E;"> id </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span></span></code></pre></div><h4 id="导出数据" tabindex="-1">导出数据 <a class="header-anchor" href="#导出数据" aria-label="Permalink to &quot;导出数据&quot;">​</a></h4><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">mysqldump </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">u </span><span style="color:#F97583;">root</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">p 数据库名</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;">d:\\</span><span style="color:#79B8FF;">数据库名</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">sql</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">mysqldump </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">u </span><span style="color:#D73A49;">root</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">p 数据库名</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">d:\\</span><span style="color:#005CC5;">数据库名</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">sql</span></span></code></pre></div><h4 id="批量操作" tabindex="-1">批量操作 <a class="header-anchor" href="#批量操作" aria-label="Permalink to &quot;批量操作&quot;">​</a></h4><ul><li>批量删除索引</li></ul><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">SELECT</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#79B8FF;">CONCAT</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;ALTER TABLE \`&quot;</span><span style="color:#E1E4E8;">, TABLE_NAME,</span><span style="color:#9ECBFF;">&quot;\` DROP INDEX IX_DELETED;&quot;</span><span style="color:#E1E4E8;">) </span></span>
<span class="line"><span style="color:#F97583;">FROM</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">INFORMATION_SCHEMA</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">STATISTICS</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">WHERE</span><span style="color:#E1E4E8;"> TABLE_SCHEMA </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;aps_vn1&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">AND</span><span style="color:#E1E4E8;"> INDEX_NAME </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;IX_DELETED&#39;</span><span style="color:#E1E4E8;">;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">SELECT</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#005CC5;">CONCAT</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;ALTER TABLE \`&quot;</span><span style="color:#24292E;">, TABLE_NAME,</span><span style="color:#032F62;">&quot;\` DROP INDEX IX_DELETED;&quot;</span><span style="color:#24292E;">) </span></span>
<span class="line"><span style="color:#D73A49;">FROM</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">INFORMATION_SCHEMA</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">STATISTICS</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">WHERE</span><span style="color:#24292E;"> TABLE_SCHEMA </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;aps_vn1&#39;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">AND</span><span style="color:#24292E;"> INDEX_NAME </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;IX_DELETED&#39;</span><span style="color:#24292E;">;</span></span></code></pre></div><h4 id="优化sql" tabindex="-1">优化SQL <a class="header-anchor" href="#优化sql" aria-label="Permalink to &quot;优化SQL&quot;">​</a></h4><ul><li>统一修改字符集(生产修改的sql然后统一执行)</li></ul><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">select</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#F97583;">distinct</span></span>
<span class="line"><span style="color:#79B8FF;">CONCAT</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;ALTER TABLE \`&quot;</span><span style="color:#E1E4E8;">, TABLE_NAME,</span><span style="color:#9ECBFF;">&quot;\` CONVERT TO CHARACTER SET utf8 COLLATE utf8_general_ci;&quot;</span><span style="color:#E1E4E8;">) </span></span>
<span class="line"><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">information_schema</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">COLUMNS</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">where</span><span style="color:#E1E4E8;"> TABLE_SCHEMA </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;fit&#39;</span><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">and</span><span style="color:#E1E4E8;"> table_name </span><span style="color:#F97583;">like</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;t_pom%&#39;</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#F97583;">and</span><span style="color:#E1E4E8;"> (character_set_name </span><span style="color:#F97583;">!=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;utf8&#39;</span></span>
<span class="line"><span style="color:#F97583;">or</span><span style="color:#E1E4E8;"> collation_name </span><span style="color:#F97583;">!=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;utf8_general_ci&#39;</span><span style="color:#E1E4E8;">)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">select</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#D73A49;">distinct</span></span>
<span class="line"><span style="color:#005CC5;">CONCAT</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;ALTER TABLE \`&quot;</span><span style="color:#24292E;">, TABLE_NAME,</span><span style="color:#032F62;">&quot;\` CONVERT TO CHARACTER SET utf8 COLLATE utf8_general_ci;&quot;</span><span style="color:#24292E;">) </span></span>
<span class="line"><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">information_schema</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">COLUMNS</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">where</span><span style="color:#24292E;"> TABLE_SCHEMA </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;fit&#39;</span><span style="color:#24292E;">  </span><span style="color:#D73A49;">and</span><span style="color:#24292E;"> table_name </span><span style="color:#D73A49;">like</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;t_pom%&#39;</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#D73A49;">and</span><span style="color:#24292E;"> (character_set_name </span><span style="color:#D73A49;">!=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;utf8&#39;</span></span>
<span class="line"><span style="color:#D73A49;">or</span><span style="color:#24292E;"> collation_name </span><span style="color:#D73A49;">!=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;utf8_general_ci&#39;</span><span style="color:#24292E;">)</span></span></code></pre></div><ul><li>修改索引表的查询顺序</li></ul><p>在内连接中，强制使用左表当作驱动表，改表优化器对于联表查询的执行顺序</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">STRAiGHT_JOIN</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">STRAiGHT_JOIN</span></span></code></pre></div><ul><li>强制索引</li></ul><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">SELECT</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">FROM</span><span style="color:#E1E4E8;"> table_name </span><span style="color:#F97583;">FORCE</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">INDEX</span><span style="color:#E1E4E8;"> (index_name);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">SELECT</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">FROM</span><span style="color:#24292E;"> table_name </span><span style="color:#D73A49;">FORCE</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">INDEX</span><span style="color:#24292E;"> (index_name);</span></span></code></pre></div><ul><li>分析表</li></ul><p>以便优化器可以更好地理解表的结构，更新表的统计信息包括行数、索引使用情况等</p><div class="language-SQL vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">SQL</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">analyze </span><span style="color:#F97583;">table</span><span style="color:#E1E4E8;"> 表名</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">analyze </span><span style="color:#D73A49;">table</span><span style="color:#24292E;"> 表名</span></span></code></pre></div><h4 id="常见的mysql配置" tabindex="-1">常见的mysql配置 <a class="header-anchor" href="#常见的mysql配置" aria-label="Permalink to &quot;常见的mysql配置&quot;">​</a></h4><div class="language-mysql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mysql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">show VARIABLES</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">show VARIABLES</span></span></code></pre></div><ul><li>慢sql相关</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">slow_query_log: 是否启用慢查询日志功能</span></span>
<span class="line"><span style="color:#e1e4e8;">long_query_time: 定义慢查询的阈值时间，超过该时间的查询会被记录在慢查询日志中</span></span>
<span class="line"><span style="color:#e1e4e8;">log_queries_not_using_indexes: 是否记录未使用索引的查询语句</span></span>
<span class="line"><span style="color:#e1e4e8;">log_slow_admin_statements: 是否记录管理员操作的慢查询语句</span></span>
<span class="line"><span style="color:#e1e4e8;">log_slow_slave_statements: 是否记录从服务器执行的慢查询语句</span></span>
<span class="line"><span style="color:#e1e4e8;">slow_query_log_file: 慢查询日志文件的路径</span></span>
<span class="line"><span style="color:#e1e4e8;">slow_query_log_timestamp_always: 是否在慢查询日志中始终包含时间戳</span></span>
<span class="line"><span style="color:#e1e4e8;">slow_query_log_timestamp_precision: 慢查询日志时间戳的精度</span></span>
<span class="line"><span style="color:#e1e4e8;">log_output: 慢查询日志的输出方式，可以选择FILE、TABLE或者NONE</span></span>
<span class="line"><span style="color:#e1e4e8;">log_slow_rate_limit: 控制慢查询日志记录速率的限制</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">slow_query_log: 是否启用慢查询日志功能</span></span>
<span class="line"><span style="color:#24292e;">long_query_time: 定义慢查询的阈值时间，超过该时间的查询会被记录在慢查询日志中</span></span>
<span class="line"><span style="color:#24292e;">log_queries_not_using_indexes: 是否记录未使用索引的查询语句</span></span>
<span class="line"><span style="color:#24292e;">log_slow_admin_statements: 是否记录管理员操作的慢查询语句</span></span>
<span class="line"><span style="color:#24292e;">log_slow_slave_statements: 是否记录从服务器执行的慢查询语句</span></span>
<span class="line"><span style="color:#24292e;">slow_query_log_file: 慢查询日志文件的路径</span></span>
<span class="line"><span style="color:#24292e;">slow_query_log_timestamp_always: 是否在慢查询日志中始终包含时间戳</span></span>
<span class="line"><span style="color:#24292e;">slow_query_log_timestamp_precision: 慢查询日志时间戳的精度</span></span>
<span class="line"><span style="color:#24292e;">log_output: 慢查询日志的输出方式，可以选择FILE、TABLE或者NONE</span></span>
<span class="line"><span style="color:#24292e;">log_slow_rate_limit: 控制慢查询日志记录速率的限制</span></span></code></pre></div><ul><li>连接相关</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">max_connections: 允许的最大连接数</span></span>
<span class="line"><span style="color:#e1e4e8;">wait_timeout: 客户端连接没有活动时，服务器将关闭连接之前等待的秒数</span></span>
<span class="line"><span style="color:#e1e4e8;">interactive_timeout: 客户端连接没有活动时，服务器将关闭连接之前等待的秒数</span></span>
<span class="line"><span style="color:#e1e4e8;">connect_timeout: 客户端连接到服务器的超时时间</span></span>
<span class="line"><span style="color:#e1e4e8;">max_user_connections: 每个用户的最大连接数限制</span></span>
<span class="line"><span style="color:#e1e4e8;">thread_cache_size: 线程缓存池的大小，用于重用已经创建的线程</span></span>
<span class="line"><span style="color:#e1e4e8;">max_connect_errors: 允许的连接错误次数，超过该次数后将禁止连接</span></span>
<span class="line"><span style="color:#e1e4e8;">back_log: 服务器在拒绝新连接之前可以排队的最大连接数</span></span>
<span class="line"><span style="color:#e1e4e8;">net_read_timeout: 从服务器读取数据的超时时间</span></span>
<span class="line"><span style="color:#e1e4e8;">net_write_timeout: 向服务器写入数据的超时时间</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">max_connections: 允许的最大连接数</span></span>
<span class="line"><span style="color:#24292e;">wait_timeout: 客户端连接没有活动时，服务器将关闭连接之前等待的秒数</span></span>
<span class="line"><span style="color:#24292e;">interactive_timeout: 客户端连接没有活动时，服务器将关闭连接之前等待的秒数</span></span>
<span class="line"><span style="color:#24292e;">connect_timeout: 客户端连接到服务器的超时时间</span></span>
<span class="line"><span style="color:#24292e;">max_user_connections: 每个用户的最大连接数限制</span></span>
<span class="line"><span style="color:#24292e;">thread_cache_size: 线程缓存池的大小，用于重用已经创建的线程</span></span>
<span class="line"><span style="color:#24292e;">max_connect_errors: 允许的连接错误次数，超过该次数后将禁止连接</span></span>
<span class="line"><span style="color:#24292e;">back_log: 服务器在拒绝新连接之前可以排队的最大连接数</span></span>
<span class="line"><span style="color:#24292e;">net_read_timeout: 从服务器读取数据的超时时间</span></span>
<span class="line"><span style="color:#24292e;">net_write_timeout: 向服务器写入数据的超时时间</span></span></code></pre></div><ul><li>查询缓存</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">query_cache_type: 查询缓存的类型，可以设置为OFF、ON或者DEMAND</span></span>
<span class="line"><span style="color:#e1e4e8;">query_cache_size: 查询缓存的大小</span></span>
<span class="line"><span style="color:#e1e4e8;">query_cache_limit: 查询结果的大小限制，超过该大小的查询结果不会被缓存</span></span>
<span class="line"><span style="color:#e1e4e8;">query_cache_min_res_unit: 查询结果的最小缓存单位</span></span>
<span class="line"><span style="color:#e1e4e8;">query_cache_strip_comments: 是否在缓存查询前去除注释</span></span>
<span class="line"><span style="color:#e1e4e8;">query_cache_wlock_invalidate: 是否在写锁时使查询缓存无效</span></span>
<span class="line"><span style="color:#e1e4e8;">query_cache_limit: 查询结果的大小限制，超过该大小的查询结果不会被缓存</span></span>
<span class="line"><span style="color:#e1e4e8;">query_cache_type: 查询缓存的类型，可以设置为OFF、ON或者DEMAND</span></span>
<span class="line"><span style="color:#e1e4e8;">query_cache_size: 查询缓存的大小</span></span>
<span class="line"><span style="color:#e1e4e8;">query_cache_min_res_unit: 查询结果的最小缓存单位</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">query_cache_type: 查询缓存的类型，可以设置为OFF、ON或者DEMAND</span></span>
<span class="line"><span style="color:#24292e;">query_cache_size: 查询缓存的大小</span></span>
<span class="line"><span style="color:#24292e;">query_cache_limit: 查询结果的大小限制，超过该大小的查询结果不会被缓存</span></span>
<span class="line"><span style="color:#24292e;">query_cache_min_res_unit: 查询结果的最小缓存单位</span></span>
<span class="line"><span style="color:#24292e;">query_cache_strip_comments: 是否在缓存查询前去除注释</span></span>
<span class="line"><span style="color:#24292e;">query_cache_wlock_invalidate: 是否在写锁时使查询缓存无效</span></span>
<span class="line"><span style="color:#24292e;">query_cache_limit: 查询结果的大小限制，超过该大小的查询结果不会被缓存</span></span>
<span class="line"><span style="color:#24292e;">query_cache_type: 查询缓存的类型，可以设置为OFF、ON或者DEMAND</span></span>
<span class="line"><span style="color:#24292e;">query_cache_size: 查询缓存的大小</span></span>
<span class="line"><span style="color:#24292e;">query_cache_min_res_unit: 查询结果的最小缓存单位</span></span></code></pre></div>`,56);function d(F,C,_,h,u,A){const a=e("font");return t(),c("div",null,[E,l(a,{color:"red"},{default:n(()=>[p("获取某个表的某个字段信息")]),_:1}),y,l(a,{color:"red"},{default:n(()=>[p("参数连接")]),_:1}),i])}const D=o(r,[["render",d]]);export{m as __pageData,D as default};
